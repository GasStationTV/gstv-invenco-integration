# Media Updates

A message is sent when a file has been added to a playlist or a current file in a playlist has been updated.

<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [Media Updates](#media-updates)
  - [Ideal Path](#ideal-path)
    - [What GSTV Sends to Invenco](#what-gstv-sends-to-invenco)
    - [What Invenco Sends to GSTV on Success](#what-invenco-sends-to-gstv-on-success)
  - [Error Path](#error-path)
    - [What Invenco Sends if the File is Not Found in S3](#what-invenco-sends-if-the-file-is-not-found-in-s3)
    - [What Invenco Sends if the MD5 Does Not Match After Download](#what-invenco-sends-if-the-md5-does-not-match-after-download)
    - [What Invenco Sends if the File Download Does Not Complete](#what-invenco-sends-if-the-file-download-does-not-complete)

<!-- /TOC -->

## Key/Value Glossary
### Fields from GSTV Messages
- **filename** - Filename - including file extension - of video to control.
- **checksum** - MD5 checksum for the video asset. This value should be used to ensure the correct and full video asset is being downloaded by Invenco.
- **fileUpdatedOn** - UTC datetime when the video asset was updated.


### Additional Fields in Invenco Responses
- **notificationType** - A String indicating the step in the update process to which this notification refers.  Valid values are:
  * MEDIA_CHECK
  * MEDIA_DOWNLOAD
  * MEDIA_CHECKSUM_VALIDATION
  * MEDIA_TRANSCODED
  * MEDIA_PUSH_TO_PLAYERS
  * MEDIA_ACCEPTED_BY_PLAYERS
  * MEDIA_POP_FAILED
- **notificationTimestamp** - A date and time (in UTC) that indicates when this notification was created.  This can be used to ensure notifications are read in the appropriate order.  The format will be `year-month-day hours:mins:secs:millis`.  24 hour time will be used.
- **status** - A String that will indicate if the step in the update process for which this notification was generated succeeded or failed.  Valid values are `Success` and `Failure`.
- **id** - A unique identifier for this notification, generated by Invenco, that will be used to refer to the notification in human communication.
- **additionalInformation** - A free-form String that can be a message or other details about the notification.  This should be human-readable.

## Ideal Path
### What GSTV Sends to Invenco
```javascript
{
  "filename": String,
  "checksum": String,
  "fileUpdatedOn": "18:41"
}
```

### What Invenco Sends to GSTV on Success
```javascript
{
  "id": String,
  "filename": String,
  "notificationTimestamp": String
  "notificationType": String,
  "status": "success",
  "additionalInformation": String
}
```

## Error Path
### What Invenco Sends if the File is Not Found in S3
Follow [Media Error Handling](#media-error-handling).

```javascript
{
  "id": String,
  "filename": String,
  "notificationTimestamp": String
  "notificationType": String,
  "status": "failure",
  "additionalInformation": String
}
```

### What Invenco Sends if the MD5 Does Not Match After Download
Follow [Media Error Handling](#media-error-handling).

```javascript
{
  "id": String,
  "filename": String,
  "notificationTimestamp": String
  "notificationType": String,
  "status": "failure",
  "additionalInformation": String
}
```

### What Invenco Sends if the File Download Does Not Complete
1. Invenco should retry downloading the file three times.
1. If the download is still unsuccessful follow [Media Error Handling](#media-error-handling).

```javascript
{
  "id": String,
  "filename": String,
  "notificationTimestamp": String
  "notificationType": String,
  "status": "failure",
  "additionalInformation": String
}
```

## Standard Operating Procedure
### Applying Configuration Updates

### Error Handling
#### Media Error Handling
1. Send a notification message to GSTV alerting that an error has occurred.
1. Playback does not stop.
1. The affected file is skipped during playback.
1. GSTV sends another notification update message.
