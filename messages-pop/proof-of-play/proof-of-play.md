# Invenco Initiated Message - Proof of Play

<!-- TOC depthFrom:1 depthTo:6 withLinks:1 updateOnSave:1 orderedList:0 -->

- [Proof of PLay Updates](#proofofplay-updates)
	- [Key/Value Glossary](#keyvalue-glossary)
		- [Field from Invenco Messages](#field-from-invenco-messages)
	- [Ideal Path](#ideal-path)
		- [What Invenco Sends to GSTV](#what-invenco-sends-to-gstv)
	- [Error Path](#error-path)
		- [What Invenco Sends if Post to GSTV Fails](#what-invenco-sends-if-post-to-gstv-fails)

<!-- /TOC -->


## Key/Value Glossary
### Field from Invenco Messages
- **id** - _required_ - A unique identifier for this notification, generated by Invenco, that will be used to refer to the notification in human communication.
- **filename** - _required_ - Filename of the video to be played.
- **assetId** - _required_ - A string assigned to the media asset by GSTV. This identifier should be included in the ProofofPlay packet coming from Invenco to GSTV. This value is carried over from the playlist update notification.
- **tiNumber** - This value is internal to GSTV. This value needs to be passed back to GSTV on the ProofofPlayPacket. This value is carried over from the playlist update notification.
- **startTimestamp** - _required_ - A date and time (in UTC) that indicates when the video asset started to play. The format will be `year-month-day hours:mins:secs:milliseconds` using 24 hour time.
- **endTimestamp** - _required_ - A date and time (in UTC) that indicates when the video asset stopped playing. The format will be `year-month-day hours:mins:secs:milliseconds` using 24 hour time.
- **screenState** - The state of the screen at the start of playback for the 12" model.
  - Values
    - full
    - partial
- **siteId** - _required_ - The Invenco name of the site.
- **terminalId** - _required_ - The id of the terminal at the site.

### Additional Fields in Invenco Error Responses
- **notificationType** - A string indicating the step in the update process to which this notification refers.
  - Values
    - MEDIA_POP_FAILED
- **notificationTimestamp** - A date and time (in UTC) that indicates when this notification was created. This can be used to ensure notifications are read in the appropriate order. The format will be `year-month-day hours:mins:secs:milliseconds` using 24 hour time.
- **status** - A String that will indicate if the step in the update process for which this notification was generated succeeded or failed.
  - Values
    - failure

## Ideal Path
### What Invenco Sends to GSTV
```javascript
{
  "filename": String,
  "assetId": String,
  "tiNumber": String
  "startTimestamp": String,
  "endTimestamp": String,
  "screenState": String,
  "siteId": String,
  "terminalId": String
}
```

## Error Path
### What Invenco Sends if Post to GSTV Fails
1. Invenco should retry sending the update three times.
1. If the update still can't be posted, Invenco should retain the POP update to re-process later
1. Send a notification message to GSTV alerting that an error has occurred.

```javascript

{
  "id": String,
  "notificationTimestamp": String
  "notificationType": "MEDIA_POP_FAILED",
  "siteId": String,
  "status": "failure",
  "terminalId": String
}
